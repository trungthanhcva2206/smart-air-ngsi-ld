# ========================================
# Smart Air NGSI-LD - Environment Configuration Template
# ========================================
# üìã Instructions:
#   1. Copy this file to .env:
#      cp .env.example .env
#   2. Fill in your actual values (especially API keys and passwords)
#   3. Never commit .env to git (already in .gitignore)
# ========================================

# ========================================
# üåê VPS & Domain Configuration
# ========================================
# Replace with your VPS IP address
VPS_IP=YOUR_VPS_IP_HERE

# Replace with your domain (or use IP if no domain)
DOMAIN=yourdomain.com

# SSL Configuration (set to true after installing SSL certificate)
SSL_ENABLED=false

# Public URLs (update these based on your domain/IP)
FRONTEND_PUBLIC_URL=http://yourdomain.com
BACKEND_PUBLIC_URL=http://api.yourdomain.com
ROUTE_PUBLIC_URL=http://route.yourdomain.com
GRAFANA_PUBLIC_URL=http://grafana.yourdomain.com

# ========================================
# üå¶Ô∏è OpenWeather API (REQUIRED)
# ========================================
# Get your free API key from: https://openweathermap.org/api
# Free tier: 1000 calls/day (sufficient for 3 cycles/day √ó 252 districts)
OPENWEATHER_API_KEY=YOUR_OPENWEATHER_API_KEY_HERE

# ========================================
# üîß ETL Configuration
# ========================================
# ETL Mode Options:
#   - rest: Direct REST API to Orion-LD (traditional approach)
#   - mqtt: MQTT ‚Üí IoT Agent ‚Üí Orion-LD (FIWARE compliant)
#   - dual: Both paths (recommended for first run)
ETL_MODE=dual

# ETL Interval (minutes)
# 480 minutes = 8 hours (3 cycles/day to stay under API limit)
ETL_INTERVAL_MINUTES=480

# Logging Level (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO

# Path to Hanoi GeoJSON file (containing district/ward geography data)
HANOI_GEOJSON_PATH=etl/Data/ha_noi_with_latlon2.geojson

# ========================================
# üåê FIWARE Orion-LD Context Broker (Docker Internal)
# ========================================
# For Docker deployment, use service name (orion)
# For localhost development, use http://localhost:1026
ORION_LD_URL=http://orion:1026
ORION_LD_TENANT=hanoi
ORION_SERVICE_PATH=/

# ========================================
# ‚è±Ô∏è FIWARE QuantumLeap Time-Series Service (Docker Internal)
# ========================================
QUANTUMLEAP_EXTERNAL_URL=http://quantumleap:8668
QUANTUMLEAP_INTERNAL_URL=http://quantumleap:8668
QUANTUMLEAP_ENABLED=true
QUANTUMLEAP_FIWARE_SERVICE=hanoi
QUANTUMLEAP_QUERY_LASTN=720
QUANTUMLEAP_QUERY_DELAY_SECONDS=2

# ========================================
# üì° MQTT Broker Configuration (Docker Internal)
# ========================================
# For Docker: use service name (mosquitto)
# For localhost: use localhost
MQTT_BROKER_HOST=mosquitto
MQTT_BROKER_PORT=1883
MQTT_BROKER_DOCKER_HOST=mosquitto

# ========================================
# üîå FIWARE IoT Agent Configuration (Docker Internal)
# ========================================
IOT_AGENT_URL=http://iot-agent:4041
IOT_AGENT_DOCKER_URL=http://iot-agent:4041
IOT_AGENT_HTTP_PORT=7896
FIWARE_SERVICE=hanoi
FIWARE_API_KEY=hanoi

# ========================================
# üóÑÔ∏è MySQL Database (Spring Boot Backend)
# ========================================
# ‚ö†Ô∏è IMPORTANT: Change these passwords in production!
MYSQL_ROOT_PASSWORD=CHANGE_THIS_ROOT_PASSWORD_PRODUCTION
MYSQL_DATABASE=smartair_db
MYSQL_USER=smartair
MYSQL_PASSWORD=CHANGE_THIS_USER_PASSWORD_PRODUCTION

# For Docker: use service name (mysql-db)
# For localhost: use localhost
MYSQL_HOST=mysql-db
MYSQL_PORT=3306
MYSQL_DOCKER_HOST=mysql-db

# MySQL JDBC URL (Docker Internal)
SPRING_DATASOURCE_URL=jdbc:mysql://mysql-db:3306/smartair_db?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Ho_Chi_Minh

# ========================================
# üêò TimescaleDB (QuantumLeap Storage)
# ========================================
# ‚ö†Ô∏è IMPORTANT: Change password in production!
POSTGRES_USER=quantumleap
POSTGRES_PASSWORD=CHANGE_THIS_POSTGRES_PASSWORD_PRODUCTION
POSTGRES_DB=quantumleap

# For Docker: use service name (timescale-db)
TIMESCALE_HOST=timescale-db
TIMESCALE_PORT=5432
TIMESCALE_DOCKER_HOST=timescale-db

# ========================================
# üî¥ Redis Cache (Docker Internal)
# ========================================
# For Docker: use service name (redis-cache)
REDIS_HOST=redis-cache
REDIS_PORT=6379
REDIS_DOCKER_HOST=redis-cache

# ========================================
# üìä Grafana
# ========================================
# ‚ö†Ô∏è IMPORTANT: Change admin password in production!
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=CHANGE_THIS_GRAFANA_PASSWORD_PRODUCTION
GRAFANA_PORT=3000

# ========================================
# üöÄ Spring Boot Backend Configuration
# ========================================
BACKEND_PORT=8123

# For Docker: use service name (backend)
BACKEND_URL=http://backend:8123
BACKEND_DOCKER_URL=http://backend:8123

# Timeout Settings (milliseconds)
SPRING_WEBFLUX_CLIENT_CONNECT_TIMEOUT=10000
SPRING_WEBFLUX_CLIENT_READ_TIMEOUT=30000
SPRING_WEBFLUX_CLIENT_WRITE_TIMEOUT=30000

# Reactor Netty Connection Pool Settings
SPRING_REACTOR_NETTY_POOL_MAX_CONNECTIONS=50
SPRING_REACTOR_NETTY_POOL_MAX_IDLE_TIME=20s

# ========================================
# üìß Email Configuration (Gmail SMTP)
# ========================================
# üìå How to get Gmail App Password:
#   1. Go to: https://myaccount.google.com/security
#   2. Enable 2-Step Verification
#   3. Create App Password: https://myaccount.google.com/apppasswords
#   4. Use the generated 16-character password below

SPRING_MAIL_HOST=smtp.gmail.com
SPRING_MAIL_PORT=587
SPRING_MAIL_USERNAME=YOUR_GMAIL_ADDRESS@gmail.com
SPRING_MAIL_PASSWORD=YOUR_GMAIL_APP_PASSWORD_16_CHARS
MAIL_FROM_NAME=Smart Air Quality Alert System

# ========================================
# üé® Frontend Configuration
# ========================================
FRONTEND_PORT=5137

# Update these URLs based on your deployment:
# - For localhost: http://localhost:8123 and http://localhost:5000
# - For domain: http://api.yourdomain.com and http://route.yourdomain.com
# - For IP: http://YOUR_VPS_IP:8123 and http://YOUR_VPS_IP:5000
VITE_API_URL=http://api.yourdomain.com
VITE_API_ROUTE_URL=http://route.yourdomain.com

# ========================================
# üó∫Ô∏è Route-Finding Service Configuration
# ========================================
ROUTE_FINDING_PORT=5000
FLASK_HOST=0.0.0.0
FLASK_PORT=5000
FLASK_DEBUG=False

# Graph & Data Files (must exist in route-finding directory)
GRAPH_FILE=hanoi_road_network.graphml
GEOJSON_FILE=ha_noi_with_latlon2.geojson

# SSE Endpoint (Server-Sent Events for real-time data)
# For Docker: use service name
SSE_ENDPOINT=http://backend:8123/api/sse/environment-data
SSE_ENDPOINT_DOCKER=http://backend:8123/api/sse/environment-data

# Data Refresh Interval (seconds)
REFRESH_INTERVAL_SECONDS=3600

# ========================================
# üì± Blynk & Telegram Notification Service
# ========================================
# üìå Get Blynk Token:
#   1. Create account at: https://blynk.cloud
#   2. Create new template
#   3. Add device and get auth token

BLYNK_TOKEN=YOUR_BLYNK_AUTH_TOKEN_HERE
BLYNK_SERVER=blynk.cloud

# üìå Get Telegram Bot Token:
#   1. Talk to @BotFather on Telegram
#   2. Create new bot: /newbot
#   3. Copy the token (format: 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz)

TELEGRAM_BOT_TOKEN=YOUR_TELEGRAM_BOT_TOKEN_HERE

# Webhook Configuration (for receiving notifications from Blynk/Telegram)
WEBHOOK_HOST=0.0.0.0
WEBHOOK_PORT=4999

# Update based on your deployment:
# - For localhost: http://localhost:4999
# - For domain: http://webhook.yourdomain.com
# - For IP: http://YOUR_VPS_IP:4999
WEBHOOK_URL=http://webhook.yourdomain.com

# ========================================
# üê≥ Docker Network Configuration
# ========================================
DOCKER_NETWORK=fiware-network

# Docker Host Gateway
# - Windows/Mac: host.docker.internal
# - Linux VPS: 172.17.0.1 (default Docker bridge network gateway)
DOCKER_HOST_GATEWAY=172.17.0.1

# ========================================
# üîí Production Security Settings
# ========================================
# JWT Secret Key (IMPORTANT: Generate a secure random 64-character string)
# You can generate one using: openssl rand -base64 64 | tr -d '\n'
JWT_SECRET=CHANGE_THIS_TO_SECURE_RANDOM_64_CHARACTER_STRING_PRODUCTION

# CORS (Cross-Origin Resource Sharing) Allowed Origins
# Add all domains/IPs that should be allowed to access the API
# Separate multiple origins with commas (no spaces)
CORS_ALLOWED_ORIGINS=http://yourdomain.com,https://yourdomain.com,http://api.yourdomain.com,https://api.yourdomain.com,http://localhost:5137

# ========================================
# üåç Production/VPS Deployment Notes
# ========================================
# 
# LOCALHOST DEPLOYMENT:
# --------------------
# 1. Use localhost in all URLs:
#    ORION_LD_URL=http://localhost:1026
#    MYSQL_HOST=localhost
#    VITE_API_URL=http://localhost:8123
#
# VPS DEPLOYMENT (with IP):
# --------------------------
# 1. Replace localhost with service names (for Docker internal communication)
# 2. Update public URLs with your VPS IP:
#    VITE_API_URL=http://YOUR_VPS_IP:8123
#    VITE_API_ROUTE_URL=http://YOUR_VPS_IP:5000
# 3. Configure firewall to allow ports: 80, 443, 1026, 8123, 5000, 5137, 3000
#
# VPS DEPLOYMENT (with Domain):
# ------------------------------
# 1. Configure DNS A records:
#    @ -> YOUR_VPS_IP
#    api -> YOUR_VPS_IP
#    route -> YOUR_VPS_IP
#    grafana -> YOUR_VPS_IP
#    webhook -> YOUR_VPS_IP
# 2. Install Nginx reverse proxy (see deploy-vps-domain.sh)
# 3. Update URLs:
#    VITE_API_URL=http://api.yourdomain.com
#    VITE_API_ROUTE_URL=http://route.yourdomain.com
# 4. (Optional) Install SSL certificate:
#    sudo certbot --nginx -d yourdomain.com -d api.yourdomain.com
# 5. Update SSL_ENABLED=true after SSL installation
#
# ========================================

# ========================================
# üìù Additional Notes
# ========================================
#
# API Rate Limits:
# ----------------
# - OpenWeather Free Tier: 1000 calls/day
# - Current ETL config: 3 cycles/day √ó 252 districts = 756 calls/day ‚úÖ
# - To reduce: increase ETL_INTERVAL_MINUTES
#
# Security Checklist:
# -------------------
# [ ] Change all default passwords
# [ ] Generate secure JWT_SECRET
# [ ] Configure CORS_ALLOWED_ORIGINS
# [ ] Enable SSL in production (SSL_ENABLED=true)
# [ ] Secure database credentials
# [ ] Use environment-specific .env files
# [ ] Never commit .env to git
#
# Performance Tuning:
# -------------------
# - Adjust QUANTUMLEAP_QUERY_LASTN for historical data range
# - Tune SPRING_REACTOR_NETTY_POOL_MAX_CONNECTIONS based on load
# - Increase REFRESH_INTERVAL_SECONDS to reduce API calls
# - Monitor ETL logs and adjust ETL_INTERVAL_MINUTES if needed
#
# Monitoring:
# -----------
# - Grafana: http://grafana.yourdomain.com (admin/password)
# - Backend health: http://api.yourdomain.com/actuator/health
# - Orion-LD version: http://YOUR_VPS_IP:1026/version
# - QuantumLeap health: http://YOUR_VPS_IP:8668/health
#
# ========================================